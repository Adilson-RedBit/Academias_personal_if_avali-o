<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Avalia√ß√£o F√≠sica Inteligente - An√°lise corporal em 5 minutos">
    <meta name="theme-color" content="#8B5CF6">
    <title>Avalia√ß√£o F√≠sica Inteligente</title>
    <link rel="stylesheet" href="styles.css">
    <!-- FASE 3: Manifest para PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==">
</head>

<body>
    <!-- Skip to main content - FASE 3: Acessibilidade -->
    <a href="#main-content" class="skip-to-main">Ir para conte√∫do principal</a>

    <!-- Containers de mensagens - FASE 1 -->
    <div id="error-message" role="alert" aria-live="assertive" style="display: none; position: fixed; top: 20px; left: 20px; right: 20px; z-index: 1000;"></div>
    <div id="success-message" role="status" aria-live="polite" style="display: none; position: fixed; top: 20px; left: 20px; right: 20px; z-index: 1000;"></div>
    
    <div class="app-container">
        <!-- Tela 1: Bem-vindo -->
        <section id="welcome-screen" class="screen active" aria-labelledby="welcome-title">
            <div class="hero">
                <div class="logo-container">
                    <div class="logo-icon" aria-hidden="true">üì∏</div>
                    <h1 id="welcome-title">Avalia√ß√£o F√≠sica<br><span class="highlight">Inteligente</span></h1>
                </div>
                <p class="tagline">An√°lise corporal completa em 5 minutos usando apenas 4 fotos</p>

                <div class="benefits" role="region" aria-label="Benef√≠cios do sistema">
                    <div class="benefit-card">
                        <div class="benefit-icon" aria-hidden="true">‚ö°</div>
                        <h3>R√°pido</h3>
                        <p>5 minutos vs 30+ tradicional</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon" aria-hidden="true">üí∞</div>
                        <h3>Acess√≠vel</h3>
                        <p>Sem equipamentos caros</p>
                    </div>
                    <div class="benefit-card">
                        <div class="benefit-icon" aria-hidden="true">üìä</div>
                        <h3>Preciso</h3>
                        <p>IA com 85%+ de precis√£o</p>
                    </div>
                </div>

                <button class="btn-primary" onclick="startAssessment()" aria-label="Iniciar avalia√ß√£o f√≠sica">
                    Iniciar Avalia√ß√£o
                    <span class="btn-arrow" aria-hidden="true">‚Üí</span>
                </button>

                <div class="info-note">
                    <p>üí° <strong>Dica:</strong> Prepare 4 fotos (frente, costas, lateral esquerda e direita) com boa
                        ilumina√ß√£o e fundo
                        neutro</p>
                </div>
            </div>
        </section>

        <!-- Tela 2: Captura de Fotos -->
        <section id="photo-capture-screen" class="screen">
            <div class="screen-header">
                <button class="btn-back" onclick="goToScreen('welcome-screen')">
                    <span>‚Üê</span>
                </button>
                <h2>Captura de Fotos</h2>
                <div class="step-indicator">1/4</div>
            </div>

            <div class="photo-capture-container">
                <div class="progress-steps">
                    <div class="step" id="step-front">
                        <div class="step-circle active">1</div>
                        <span>Frontal</span>
                    </div>
                    <div class="step" id="step-back">
                        <div class="step-circle">2</div>
                        <span>Costas</span>
                    </div>
                    <div class="step" id="step-side-left">
                        <div class="step-circle">3</div>
                        <span>Lateral E</span>
                    </div>
                    <div class="step" id="step-side-right">
                        <div class="step-circle">4</div>
                        <span>Lateral D</span>
                    </div>
                </div>

                <div class="current-photo-type">
                    <h3 id="current-view-title">Vista Frontal</h3>
                    <p id="current-view-instructions">Posicione-se de frente para a c√¢mera com os bra√ßos levemente
                        afastados do corpo</p>
                </div>

                <div class="photo-preview-area">
                    <div class="silhouette-guide" id="silhouette-guide">
                        <svg viewBox="0 0 200 400" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M100,30 L90,50 L90,100 L70,150 L70,250 L80,400 M100,30 L110,50 L110,100 L130,150 L130,250 L120,400 M90,60 L70,80 L50,100 M110,60 L130,80 L150,100 M70,250 L60,300 L50,400 M130,250 L140,300 L150,400"
                                stroke="#ffffff" stroke-width="2" fill="none" stroke-dasharray="5,5" opacity="0.5" />
                        </svg>
                    </div>
                    <img id="photo-preview" class="photo-preview hidden" alt="Preview">
                    <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;"
                        onchange="handlePhotoCapture(event)">
                </div>

                <div class="tips-panel">
                    <h4>üí° Dicas para melhor resultado:</h4>
                    <ul>
                        <li>‚úì Fundo neutro e limpo</li>
                        <li>‚úì Boa ilumina√ß√£o natural</li>
                        <li>‚úì Corpo inteiro vis√≠vel</li>
                        <li>‚úì Roupas justas ou traje de banho</li>
                    </ul>
                </div>

                <button class="btn-capture" id="btn-capture" onclick="triggerPhotoCapture()">
                    üì∑ Tirar Foto
                </button>
                <button class="btn-primary hidden" id="btn-next-photo" onclick="nextPhoto()">
                    Pr√≥xima Foto ‚Üí
                </button>
            </div>
        </section>

        <!-- Tela 3: Dados Complementares -->
        <section id="data-form-screen" class="screen">
            <div class="screen-header">
                <button class="btn-back" onclick="goToScreen('photo-capture-screen')">
                    <span>‚Üê</span>
                </button>
                <h2>Dados Complementares</h2>
                <div class="step-indicator">2/4</div>
            </div>

            <div class="form-container">
                <div class="captured-photos-summary">
                    <h3>Fotos Capturadas ‚úì</h3>
                    <div class="photo-thumbnails">
                        <div class="thumbnail" id="thumb-front">
                            <img id="thumb-front-img" alt="Frontal">
                            <span>Frontal</span>
                        </div>
                        <div class="thumbnail" id="thumb-back">
                            <img id="thumb-back-img" alt="Costas">
                            <span>Costas</span>
                        </div>
                        <div class="thumbnail" id="thumb-side-left">
                            <img id="thumb-side-left-img" alt="Lateral E">
                            <span>Lateral E</span>
                        </div>
                        <div class="thumbnail" id="thumb-side-right">
                            <img id="thumb-side-right-img" alt="Lateral D">
                            <span>Lateral D</span>
                        </div>
                    </div>
                </div>

                <form id="complementary-data-form" role="form" aria-label="Formul√°rio de dados complementares">
                    <div class="form-group">
                        <label for="input-weight">Peso (kg) <span aria-label="obrigat√≥rio">*</span></label>
                        <input type="number" id="input-weight" step="0.1" min="30" max="300" required
                            placeholder="Ex: 75.5" aria-required="true" aria-describedby="weight-hint">
                        <small id="weight-hint">Entre 30 e 300 kg</small>
                    </div>

                    <div class="form-group">
                        <label for="input-height">Altura (cm) <span aria-label="obrigat√≥rio">*</span></label>
                        <input type="number" id="input-height" step="1" min="100" max="250" required
                            placeholder="Ex: 175" aria-required="true" aria-describedby="height-hint">
                        <small id="height-hint">Entre 100 e 250 cm</small>
                    </div>

                    <div class="form-group">
                        <label for="input-age">Idade <span aria-label="obrigat√≥rio">*</span></label>
                        <input type="number" id="input-age" min="13" max="120" required placeholder="Ex: 30" aria-required="true" aria-describedby="age-hint">
                        <small id="age-hint">Entre 13 e 120 anos</small>
                    </div>

                    <fieldset class="form-group">
                        <legend>Sexo <span aria-label="obrigat√≥rio">*</span></legend>
                        <div class="toggle-group" role="group" aria-labelledby="gender-legend">
                            <input type="radio" id="gender-male" name="gender" value="male" required>
                            <label for="gender-male" class="toggle-option">Masculino</label>

                            <input type="radio" id="gender-female" name="gender" value="female" required>
                            <label for="gender-female" class="toggle-option">Feminino</label>
                        </div>
                    </fieldset>

                    <div class="form-group">
                        <label for="input-activity">N√≠vel de Atividade <span aria-label="obrigat√≥rio">*</span></label>
                        <select id="input-activity" required aria-required="true" aria-describedby="activity-hint">
                            <option value="">-- Selecione --</option>
                            <option value="sedentary">Sedent√°rio (pouco ou nenhum exerc√≠cio)</option>
                            <option value="light">Levemente ativo (1-3 dias/semana)</option>
                            <option value="moderate">Moderadamente ativo (3-5 dias/semana)</option>
                            <option value="very">Muito ativo (6-7 dias/semana)</option>
                            <option value="extra">Extremamente ativo (atleta/treino intenso)</option>
                        </select>
                        <small id="activity-hint">Escolha sua frequ√™ncia de exerc√≠cios semanal</small>
                    </div>

                    <div class="form-group">
                        <label for="input-goal">Objetivo Principal <span aria-label="opcional">(opcional)</span></label>
                        <select id="input-goal" aria-describedby="goal-hint">
                            <option value="">-- Selecione --</option>
                            <option value="weight-loss">Perder Peso</option>
                            <option value="muscle-gain">Ganhar Massa Muscular</option>
                            <option value="maintenance">Manuten√ß√£o</option>
                            <option value="performance">Performance Atl√©tica</option>
                            <option value="health">Sa√∫de Geral</option>
                        </select>
                        <small id="goal-hint">Ajuda a personalizar as recomenda√ß√µes</small>
                    </div>

                    <button type="submit" class="btn-primary btn-generate" aria-label="Gerar an√°lise corporal">
                        üî¨ Gerar An√°lise
                    </button>
                </form>
            </div>
        </section>

        <!-- Tela 4: Resultados da An√°lise -->
        <section id="results-screen" class="screen">
            <div class="screen-header no-back">
                <h2>Sua An√°lise Corporal</h2>
                <button class="btn-icon" onclick="shareResults()">
                    <span>üì§</span>
                </button>
            </div>

            <div class="results-container">
                <div class="analysis-date" id="analysis-date"></div>

                <div class="profile-card">
                    <div class="profile-photo" id="profile-photo-result">
                        <img id="profile-img" alt="Perfil">
                    </div>
                    <div class="profile-info">
                        <h3 id="user-name">An√°lise Completa</h3>
                        <p id="user-basic-info"></p>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card metric-bodyfat">
                        <div class="metric-icon">üî•</div>
                        <div class="metric-value" id="metric-bodyfat">--</div>
                        <div class="metric-label">% Gordura</div>
                    </div>
                    <div class="metric-card metric-bmi">
                        <div class="metric-icon">üìä</div>
                        <div class="metric-value" id="metric-bmi">--</div>
                        <div class="metric-label">IMC</div>
                    </div>
                    <div class="metric-card metric-ideal-weight">
                        <div class="metric-icon">üéØ</div>
                        <div class="metric-value" id="metric-ideal-weight">--</div>
                        <div class="metric-label">Peso Ideal</div>
                    </div>
                </div>

                <div class="body-type-card">
                    <h3>Tipo F√≠sico</h3>
                    <div class="body-type-result">
                        <div class="body-type-icon" id="body-type-icon">üí™</div>
                        <div class="body-type-name" id="body-type-name">Mesomorfo</div>
                        <p class="body-type-description" id="body-type-description"></p>
                    </div>
                </div>

                <div class="composition-chart">
                    <h3>Composi√ß√£o Corporal</h3>
                    <div class="chart-container">
                        <canvas id="composition-canvas"></canvas>
                    </div>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <span class="legend-color" style="background: #8B5CF6;"></span>
                            <span>Massa Muscular: <strong id="legend-muscle">--</strong></span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #F59E0B;"></span>
                            <span>Gordura Corporal: <strong id="legend-fat">--</strong></span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color" style="background: #10B981;"></span>
                            <span>Outros: <strong id="legend-other">--</strong></span>
                        </div>
                    </div>
                </div>

                <div class="recommendations-card">
                    <h3>üí° Recomenda√ß√µes</h3>
                    <div id="recommendations-list"></div>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" onclick="generateWorkoutPlan()">
                        üìã Ver Plano de Treino Sugerido
                    </button>
                    <button class="btn-secondary" onclick="shareResults()">
                        üì§ Compartilhar Relat√≥rio
                    </button>
                    <button class="btn-secondary" onclick="restartAssessment()">
                        üîÑ Nova Avalia√ß√£o
                    </button>
                </div>
            </div>
        </section>

        <!-- Tela 5: Plano de Treino (Preview) -->
        <section id="workout-plan-screen" class="screen">
            <div class="screen-header">
                <button class="btn-back" onclick="goToScreen('results-screen')">
                    <span>‚Üê</span>
                </button>
                <h2>Plano de Treino Personalizado</h2>
            </div>

            <div class="workout-plan-container">
                <div class="plan-header">
                    <div class="plan-badge">Gerado por IA</div>
                    <h3 id="plan-title">Plano Personalizado</h3>
                    <p id="plan-subtitle"></p>
                </div>

                <div class="plan-content" id="plan-content">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>

                <div class="upgrade-cta">
                    <h3>üöÄ Quer o plano completo?</h3>
                    <p>Upgrade para o plano Plus e receba:</p>
                    <ul>
                        <li>‚úì Planos de treino detalhados</li>
                        <li>‚úì Acompanhamento de progresso</li>
                        <li>‚úì Ajustes autom√°ticos</li>
                        <li>‚úì Suporte profissional</li>
                    </ul>
                    <button class="btn-primary btn-upgrade">
                        Fazer Upgrade ‚Üí
                    </button>
                </div>
            </div>
        </section>
    </div>

    <script src="app.js"></script>
    
    <!-- FASE 3: Registro de Service Worker para PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('‚úÖ Service Worker registrado:', registration);
                        
                        // Ouvir mensagens do SW
                        navigator.serviceWorker.addEventListener('message', (event) => {
                            if (event.data.type === 'UPDATE_AVAILABLE') {
                                showSuccessMessage('üîÑ Nova vers√£o dispon√≠vel! Recarregue para atualizar.');
                            }
                        });
                        
                        // Verificar por atualiza√ß√µes periodicamente
                        setInterval(() => {
                            registration.update();
                        }, 60000); // A cada 1 minuto
                    })
                    .catch((error) => {
                        console.warn('‚ùå Service Worker falhou:', error);
                    });
            });
        }
        
        // Detectar atualiza√ß√µes de SW
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('üîÑ Service Worker atualizado');
                // Opcionalmente recarregar p√°gina
            });
        }
    </script>
</body>

</html>